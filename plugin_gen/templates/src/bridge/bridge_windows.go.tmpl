// Code generated by flutter_gopher. DO NOT EDIT.
package bridge

/*
#include "include/bridge.h"
extern DLLEXPORT void fg_native_method_handle(FgRequest request, FgResponse* response);
*/
import "C"
import (
	"fmt"
	nw "native_windows"
	nwb "native_windows/bridge"
)

func init() {
	fgNativeMethodHandle = (C.FgNativeMethodHandle)(C.fg_native_method_handle)
	nwb.CallGoMethod = callGoMethod
	nwb.CallDartMethod = callDartMethod
	nwb.InitMethodHandle = initNativeMethodHandle
	go nw.Register()
}

var winNativeMethodHandle MethodHandle

//export fg_native_method_handle
func fg_native_method_handle(request C.FgRequest, response *C.FgResponse) {
	method, data := mapFromFgRequest(request)
	if winNativeMethodHandle == nil {
		response.error = mapFgDataFromString(fmt.Sprintf("call native method: %s, error: native method handle not init", method))
		return
	}

	defer func() {
		if r := recover(); r != nil {
			response.error = mapFgDataFromString(fmt.Sprintf("call native method: %s, panic err: %v", method, r))
		}
	}()

	result, err := winNativeMethodHandle(method, data)
	if err != nil {
		response.error = mapFgDataFromString(fmt.Sprintf("call native method: %s, error: %v", method, err))
		return
	}
	response.data = mapFgDataFromBytes(result)
}

func initNativeMethodHandle(handle func(method string, data []byte) ([]byte, error)) {
	winNativeMethodHandle = handle
}
